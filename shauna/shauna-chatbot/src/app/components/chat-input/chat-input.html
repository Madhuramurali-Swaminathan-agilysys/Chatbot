<div class="chat-input-container" 
     (drop)="onFileDrop($event)" 
     (dragover)="onDragOver($event)">
  
  <!-- File attachments display -->
  <div class="file-attachments" *ngIf="selectedFiles.length > 0">
    <div class="file-chip" *ngFor="let file of selectedFiles; let i = index">
      <mat-icon>{{ getFileIcon(file) }}</mat-icon>
      <span class="file-name">{{ file.name }}</span>
      <span class="file-size">({{ (file.size / 1024 / 1024).toFixed(2) }}MB)</span>
      <button mat-icon-button (click)="removeFile(i)" class="remove-file">
        <mat-icon>close</mat-icon>
      </button>
    </div>
  </div>

  <!-- Main input area -->
  <div class="input-area">
    <mat-form-field appearance="outline" class="message-input">
      <mat-label>Type your message...</mat-label>
      <textarea 
        matInput 
        [(ngModel)]="message"
        (keydown)="onKeyDown($event)"
        placeholder="Ask Shauna anything..."
        rows="1"
        cdkTextareaAutosize
        #autosize="cdkTextareaAutosize"
        [disabled]="isLoading">
      </textarea>
    </mat-form-field>

    <div class="input-actions">
      <!-- File upload button -->
      <button 
        mat-icon-button 
        matTooltip="Attach files"
        (click)="fileInput.click()"
        [disabled]="isLoading">
        <mat-icon>attach_file</mat-icon>
      </button>

      <!-- Voice input button -->
      <button 
        mat-icon-button 
        [matTooltip]="isListening ? 'Stop listening' : 'Voice input'"
        (click)="toggleVoiceInput()"
        [disabled]="isLoading"
        [class.listening]="isListening">
        <mat-icon>{{ isListening ? 'mic' : 'mic_none' }}</mat-icon>
      </button>

      <!-- Send button -->
      <button 
        mat-raised-button 
        color="primary"
        (click)="onSubmit()"
        [disabled]="(!message.trim() && selectedFiles.length === 0) || isLoading"
        matTooltip="Send message">
        <mat-icon *ngIf="!isLoading">send</mat-icon>
        <mat-spinner *ngIf="isLoading" diameter="20"></mat-spinner>
      </button>
    </div>
  </div>

  <!-- Hidden file input -->
  <input 
    #fileInput 
    type="file" 
    multiple 
    style="display: none"
    accept=".jpg,.jpeg,.png,.gif,.pdf,.txt,.doc,.docx"
    (change)="onFileSelected($event)">
    
  <!-- Voice recording indicator -->
  <div class="voice-indicator" *ngIf="isListening">
    <div class="pulse-ring"></div>
    <div class="pulse-ring-2"></div>
    <mat-icon>mic</mat-icon>
    <span>Listening...</span>
  </div>
</div>
